<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö –ï–ì–≠ –†—É—Å—Å–∫–∏–π | –ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --accent-primary: #3390ec;
            --accent-secondary: #2481cc;
            --text-primary: #17212b;
            --text-secondary: #6b7b8c;
            --text-muted: #8a9aa8;
            --border-color: #e6ecf0;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --error-color: #e74c3c;
            --exam-color: #9b59b6;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
        }

        .theme-dark {
            --bg-primary: #17212b;
            --bg-secondary: #1f2c3a;
            --bg-tertiary: #243342;
            --accent-primary: #3390ec;
            --accent-secondary: #2481cc;
            --text-primary: #e1e9f0;
            --text-secondary: #a8b5c1;
            --text-muted: #6b7b8c;
            --border-color: #2a3b4d;
            --exam-color: #8e44ad;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 8px;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 100%;
            margin: 0 auto;
            position: relative;
        }

        .header {
            padding: 12px 0;
            margin-bottom: 12px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            background: var(--accent-primary);
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
        }

        .logo-text h1 {
            font-size: 18px;
            font-weight: 700;
        }

        .logo-text p {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .header-actions {
            display: flex;
            gap: 6px;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            touch-action: manipulation;
        }

        .icon-btn:hover,
        .icon-btn:active {
            background: var(--bg-tertiary);
            transform: translateY(-1px);
        }

        .daily-stats {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: 14px;
            margin-bottom: 14px;
            border: 1px solid var(--border-color);
        }

        .stats-row {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .stat {
            flex: 1;
            text-align: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-primary);
            line-height: 1;
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 3px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            font-weight: 600;
        }

        .streak-counter {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }

        .streak-icon {
            width: 32px;
            height: 32px;
            border-radius: 16px;
            background: var(--warning-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        .streak-info {
            flex: 1;
        }

        .streak-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 2px;
        }

        .streak-days {
            font-size: 18px;
            font-weight: 700;
            color: var(--warning-color);
        }

        .streak-next {
            font-size: 10px;
            color: var(--text-muted);
        }

        .nav {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            margin-bottom: 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: 6px;
            border: 1px solid var(--border-color);
        }

        .nav-btn {
            padding: 8px 0;
            text-align: center;
            border-radius: var(--radius-md);
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            position: relative;
            touch-action: manipulation;
        }

        .nav-btn i {
            font-size: 12px;
        }

        .nav-btn.active {
            background: var(--bg-primary);
            color: var(--text-primary);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .nav-btn:hover,
        .nav-btn:active {
            background: var(--bg-tertiary);
        }

        .nav-badge {
            position: absolute;
            top: -2px;
            right: 2px;
            background: var(--error-color);
            color: white;
            font-size: 8px;
            width: 12px;
            height: 12px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .task-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .task-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--accent-primary);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .task-number {
            background: var(--bg-tertiary);
            color: var(--accent-primary);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
        }

        .task-theme {
            color: var(--text-muted);
            font-size: 12px;
            margin-top: 3px;
        }

        .task-actions {
            display: flex;
            gap: 6px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            touch-action: manipulation;
        }

        .action-btn:hover,
        .action-btn:active {
            background: var(--accent-primary);
            color: white;
            transform: translateY(-1px);
        }

        .task-text {
            line-height: 1.5;
            font-size: 14px;
            margin-bottom: 16px;
            color: var(--text-primary);
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        .task-text .highlight {
            background: var(--bg-tertiary);
            padding: 2px 4px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            color: var(--accent-primary);
        }

        .options-container {
            margin: 12px 0;
        }

        .option {
            padding: 12px;
            margin-bottom: 6px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            touch-action: manipulation;
        }

        .option:hover,
        .option:active {
            border-color: var(--accent-primary);
            background: var(--bg-tertiary);
        }

        .option.selected {
            border-color: var(--accent-primary);
            background: var(--bg-tertiary);
        }

        .option-marker {
            width: 20px;
            height: 20px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--text-muted);
            flex-shrink: 0;
            font-size: 11px;
        }

        .option.selected .option-marker {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .option-text {
            flex: 1;
            font-size: 13px;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        .answer-input {
            width: 100%;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 12px;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 12px;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .btn {
            padding: 12px 16px;
            border-radius: var(--radius-md);
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            touch-action: manipulation;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: white;
            flex: 1;
        }

        .btn-primary:hover,
        .btn-primary:active {
            background: var(--accent-secondary);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            flex: 1;
        }

        .btn-secondary:hover,
        .btn-secondary:active {
            background: var(--bg-secondary);
            transform: translateY(-1px);
        }

        .btn-exam {
            background: var(--exam-color);
            color: white;
            flex: 1;
        }

        .btn-exam:hover,
        .btn-exam:active {
            background: #8e44ad;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: var(--error-color);
            color: white;
            flex: 1;
        }

        .btn-danger:hover,
        .btn-danger:active {
            background: #c0392b;
            transform: translateY(-1px);
        }

        .buttons-row {
            display: flex;
            gap: 8px;
            margin-top: 6px;
        }

        .result {
            padding: 16px;
            border-radius: var(--radius-md);
            margin-bottom: 12px;
            text-align: center;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
        }

        .result.correct {
            border-color: var(--success-color);
            background: var(--bg-secondary);
        }

        .result.incorrect {
            border-color: var(--error-color);
            background: var(--bg-secondary);
        }

        .result-icon {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .result.correct .result-icon {
            color: var(--success-color);
        }

        .result.incorrect .result-icon {
            color: var(--error-color);
        }

        .result-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .result-desc {
            color: var(--text-secondary);
            font-size: 13px;
            line-height: 1.4;
        }

        .result-answer {
            background: var(--bg-tertiary);
            padding: 8px;
            border-radius: var(--radius-sm);
            margin-top: 10px;
            font-weight: 600;
            font-size: 13px;
        }

        .progress-bar {
            height: 5px;
            background: var(--border-color);
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-primary);
            border-radius: 3px;
            transition: width 0.6s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 12px;
        }

        .stat-card {
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            padding: 14px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .stat-card-icon {
            width: 36px;
            height: 36px;
            border-radius: 18px;
            background: var(--accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 16px;
            color: white;
        }

        .stat-card-value {
            font-size: 22px;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 3px;
        }

        .stat-card-label {
            font-size: 11px;
            color: var(--text-muted);
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 32px 16px;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 40px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 6px;
            color: var(--text-secondary);
        }

        .achievements-container {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
        }

        .achievements-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .achievements-title {
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .achievement {
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            padding: 14px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .achievement.locked {
            opacity: 0.7;
        }

        .achievement.unlocked {
            border-color: var(--warning-color);
        }

        .achievement-badge {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: var(--accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 18px;
            color: white;
        }

        .achievement.locked .achievement-badge {
            background: var(--bg-tertiary);
            color: var(--text-muted);
        }

        .achievement-title {
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .achievement-desc {
            font-size: 10px;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .achievement-progress {
            height: 3px;
            background: var(--border-color);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 6px;
        }

        .achievement-progress-fill {
            height: 100%;
            background: var(--accent-primary);
            border-radius: 2px;
        }

        .theory-section {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
        }

        .theory-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .theory-icon {
            width: 36px;
            height: 36px;
            border-radius: 18px;
            background: var(--accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }

        .theory-title {
            font-size: 16px;
            font-weight: 700;
            flex: 1;
        }

        .theory-content {
            line-height: 1.5;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .theory-content h3 {
            color: var(--text-primary);
            margin: 12px 0 6px 0;
            font-size: 14px;
        }

        .exam-variants-container {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
        }

        .exam-variants-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .exam-variants-title {
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .exam-variants-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }

        .exam-variant {
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            padding: 14px;
            text-align: center;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
            touch-action: manipulation;
        }

        .exam-variant:hover,
        .exam-variant:active {
            border-color: var(--exam-color);
            transform: translateY(-2px);
        }

        .exam-variant-icon {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: var(--exam-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 18px;
            color: white;
        }

        .exam-variant-title {
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .exam-variant-desc {
            font-size: 10px;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .exam-variant-stats {
            font-size: 9px;
            color: var(--text-secondary);
            margin-top: 6px;
            display: flex;
            justify-content: space-between;
        }

        .exam-variant-progress {
            height: 3px;
            background: var(--border-color);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 6px;
        }

        .exam-variant-progress-fill {
            height: 100%;
            background: var(--exam-color);
            border-radius: 2px;
        }

        .admin-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            z-index: 1000;
            padding: 16px;
            overflow-y: auto;
            display: none;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .admin-title {
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .close-admin {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }

        .admin-tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 12px;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 8px 12px;
            border-radius: var(--radius-md);
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            font-size: 12px;
            touch-action: manipulation;
        }

        .admin-tab.active {
            background: var(--accent-primary);
            color: white;
        }

        .admin-content {
            display: none;
        }

        .admin-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 13px;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 10px;
            font-size: 13px;
            color: var(--text-primary);
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            line-height: 1.4;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .admin-buttons {
            display: flex;
            gap: 8px;
            margin-top: 20px;
        }

        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .auth-modal.active {
            display: flex;
        }

        .auth-container {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: 20px;
            max-width: 300px;
            width: 90%;
            border: 1px solid var(--border-color);
        }

        .auth-icon {
            width: 50px;
            height: 50px;
            border-radius: 25px;
            background: var(--accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            color: white;
            font-size: 20px;
        }

        .auth-title {
            text-align: center;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .auth-subtitle {
            text-align: center;
            color: var(--text-muted);
            margin-bottom: 16px;
            font-size: 13px;
        }

        .auth-input {
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 12px;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 12px;
            text-align: center;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        .auth-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .auth-error {
            color: var(--error-color);
            text-align: center;
            margin-bottom: 12px;
            font-size: 13px;
            min-height: 18px;
        }

        .sync-status {
            position: fixed;
            bottom: 16px;
            right: 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 6px 10px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 1000;
            box-shadow: var(--shadow-md);
            display: none;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.3s;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 480px) {
            .stats-row {
                flex-direction: column;
                gap: 12px;
            }
            
            .nav {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .achievements-grid, .stats-grid, .exam-variants-grid {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 10px 14px;
                font-size: 13px;
            }
            
            .task-card, .achievements-container, .theory-section, .exam-variants-container {
                padding: 14px;
            }
            
            .admin-tabs {
                overflow-x: auto;
            }
            
            .admin-tab {
                font-size: 11px;
                padding: 6px 10px;
            }
        }
    </style>
</head>
<body class="theme-light">
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div style="color: var(--text-secondary); font-weight: 600;">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...</div>
    </div>

    <div class="app-container">
        <header class="header">
            <div class="header-top">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <div class="logo-text">
                        <h1>–ï–ì–≠ –†—É—Å—Å–∫–∏–π</h1>
                        <p>–ì–æ—Ç–æ–≤—å—Ç–µ—Å—å –≤ Telegram</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="icon-btn" id="stats-btn" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞">
                        <i class="fas fa-chart-bar"></i>
                    </button>
                    <button class="icon-btn" id="achievements-btn" title="–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è">
                        <i class="fas fa-trophy"></i>
                    </button>
                    <button class="icon-btn" id="sync-btn" title="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å">
                        <i class="fas fa-sync"></i>
                    </button>
                    <button class="icon-btn" id="admin-btn" title="–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
            
            <div class="daily-stats">
                <div class="stats-row">
                    <div class="stat">
                        <div class="stat-value" id="total-tasks">0</div>
                        <div class="stat-label">–ó–∞–¥–∞–Ω–∏–π</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="solved-count">0</div>
                        <div class="stat-label">–†–µ—à–µ–Ω–æ</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="correct-rate">0%</div>
                        <div class="stat-label">–¢–æ—á–Ω–æ—Å—Ç—å</div>
                    </div>
                </div>
                
                <div class="streak-counter">
                    <div class="streak-icon">
                        <i class="fas fa-fire"></i>
                    </div>
                    <div class="streak-info">
                        <div class="streak-title">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
                        <div class="streak-days" id="streak-days">0</div>
                        <div class="streak-next" id="streak-next">–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ –æ–±–Ω–æ–≤–∏—Ç —Å—á—ë—Ç—á–∏–∫</div>
                    </div>
                </div>
            </div>
        </header>
        
        <nav class="nav">
            <button class="nav-btn active" data-tab="practice">
                <i class="fas fa-dice"></i>
                <span>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</span>
            </button>
            <button class="nav-btn" data-tab="tasks">
                <i class="fas fa-list"></i>
                <span>–í—Å–µ –∑–∞–¥–∞–Ω–∏—è</span>
                <div class="nav-badge" id="new-tasks-badge" style="display: none;">0</div>
            </button>
            <button class="nav-btn" data-tab="exams">
                <i class="fas fa-file-alt"></i>
                <span>–ü—Ä–æ–±–Ω–∏–∫–∏</span>
                <div class="nav-badge" id="new-exams-badge" style="display: none;">0</div>
            </button>
            <button class="nav-btn" data-tab="theory">
                <i class="fas fa-graduation-cap"></i>
                <span>–¢–µ–æ—Ä–∏—è</span>
            </button>
            <button class="nav-btn" data-tab="achievements">
                <i class="fas fa-trophy"></i>
                <span>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</span>
            </button>
        </nav>
        
        <div class="tab-content active" id="practice-tab">
            <div class="task-card">
                <div class="task-header">
                    <div>
                        <div class="task-number" id="task-number">–ó–∞–¥–∞–Ω–∏–µ #1</div>
                        <div class="task-theme" id="task-theme">–û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—è</div>
                    </div>
                    <div class="task-actions">
                        <button class="action-btn" id="hint-btn" title="–ü–æ–¥—Å–∫–∞–∑–∫–∞">
                            <i class="fas fa-lightbulb"></i>
                        </button>
                        <button class="action-btn" id="favorite-btn" title="–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">
                            <i class="far fa-star"></i>
                        </button>
                    </div>
                </div>
                
                <div class="task-text" id="task-text">
                    –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞–Ω–∏—è...
                </div>
                
                <div id="options-container"></div>
                
                <div id="result-container"></div>
                
                <input type="text" class="answer-input" id="answer-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç..." autocomplete="off" style="display: none;">
                
                <div class="buttons-row">
                    <button class="btn btn-primary" id="check-btn">
                        <i class="fas fa-check"></i>
                        <span>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</span>
                    </button>
                    <button class="btn btn-secondary" id="next-btn">
                        <i class="fas fa-redo"></i>
                        <span>–°–ª–µ–¥—É—é—â–µ–µ</span>
                    </button>
                </div>
            </div>
            
            <div class="task-card">
                <div class="task-header">
                    <div>
                        <div class="task-number">–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–µ–≥–æ–¥–Ω—è</div>
                        <div class="task-theme">–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ü–µ–ª—å: 5 –∑–∞–¥–∞–Ω–∏–π</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="daily-progress" style="width: 0%"></div>
                </div>
                <div style="text-align: center; color: var(--text-muted); font-size: 12px; margin-top: 6px;">
                    –†–µ—à–µ–Ω–æ: <span id="daily-solved">0</span>/5 –∑–∞–¥–∞–Ω–∏–π
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="tasks-tab">
            <div class="task-card">
                <div class="task-header">
                    <div>
                        <div class="task-number">–í—Å–µ –∑–∞–¥–∞–Ω–∏—è</div>
                        <div class="task-theme" id="tasks-count">0 –∑–∞–¥–∞–Ω–∏–π</div>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-card-value" id="completed-tasks">0</div>
                        <div class="stat-card-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-card-value" id="favorite-tasks">0</div>
                        <div class="stat-card-label">–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º</div>
                    </div>
                </div>
            </div>
            
            <div id="tasks-list-container">
            </div>
        </div>
        
        <div class="tab-content" id="exams-tab">
            <div class="exam-variants-container">
                <div class="exam-variants-header">
                    <div class="exam-variants-title">
                        <i class="fas fa-file-alt"></i>
                        <span>–ü—Ä–æ–±–Ω–∏–∫–∏ –∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã</span>
                    </div>
                    <div id="exams-count">0 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</div>
                </div>
                
                <div class="exam-variants-grid" id="exams-grid">
                </div>
                
                <div class="buttons-row">
                    <button class="btn btn-exam" id="start-exam-btn">
                        <i class="fas fa-play-circle"></i>
                        <span>–ù–∞—á–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç</span>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="theory-tab">
            <div id="theory-content-container">
            </div>
        </div>
        
        <div class="tab-content" id="achievements-tab">
            <div class="achievements-container">
                <div class="achievements-header">
                    <div class="achievements-title">
                        <i class="fas fa-trophy"></i>
                        <span>–í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</span>
                    </div>
                    <div id="achievements-count">0/12</div>
                </div>
                
                <div class="achievements-grid" id="achievements-grid">
                </div>
            </div>
        </div>
        
        <div class="admin-panel" id="admin-panel">
            <div class="admin-header">
                <div class="admin-title">
                    <i class="fas fa-cog"></i>
                    <span>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</span>
                </div>
                <button class="close-admin" id="close-admin">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="admin-tabs">
                <button class="admin-tab active" data-admin-tab="tasks">–ó–∞–¥–∞–Ω–∏—è</button>
                <button class="admin-tab" data-admin-tab="exams">–ü—Ä–æ–±–Ω–∏–∫–∏</button>
                <button class="admin-tab" data-admin-tab="theory">–¢–µ–æ—Ä–∏—è</button>
                <button class="admin-tab" data-admin-tab="users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                <button class="admin-tab" data-admin-tab="sync">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</button>
            </div>
            
            <div class="admin-content active" id="admin-tasks-tab">
                <div class="form-group">
                    <label class="form-label">–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</label>
                    <select class="form-select" id="admin-edit-mode">
                        <option value="new">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ</option>
                        <option value="edit">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ</option>
                    </select>
                </div>
                
                <div class="form-group" id="edit-task-select-group" style="display: none;">
                    <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</label>
                    <select class="form-select" id="admin-edit-task-select">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ...</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ù–æ–º–µ—Ä –∑–∞–¥–∞–Ω–∏—è (1-27)</label>
                    <input type="number" class="form-input" id="admin-task-number" min="1" max="27" value="1">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–¢–µ–º–∞ –∑–∞–¥–∞–Ω–∏—è</label>
                    <select class="form-select" id="admin-task-theme">
                        <option value="–û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—è">–û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—è</option>
                        <option value="–ü—É–Ω–∫—Ç—É–∞—Ü–∏—è">–ü—É–Ω–∫—Ç—É–∞—Ü–∏—è</option>
                        <option value="–õ–µ–∫—Å–∏–∫–∞">–õ–µ–∫—Å–∏–∫–∞</option>
                        <option value="–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞">–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–¢–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è</label>
                    <textarea class="form-textarea" id="admin-task-text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è</label>
                    <select class="form-select" id="admin-task-type">
                        <option value="single">–û–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞</option>
                        <option value="multiple">–ù–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</option>
                        <option value="text">–¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ (—á–µ—Ä–µ–∑ ;)</label>
                    <input type="text" class="form-input" id="admin-task-options" placeholder="–í–∞—Ä–∏–∞–Ω—Ç 1; –í–∞—Ä–∏–∞–Ω—Ç 2; –í–∞—Ä–∏–∞–Ω—Ç 3">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</label>
                    <input type="text" class="form-input" id="admin-task-answer" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç...">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü–æ–¥—Å–∫–∞–∑–∫–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <textarea class="form-textarea" id="admin-task-hint" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫—É..."></textarea>
                </div>
                
                <div class="admin-buttons">
                    <button class="btn btn-primary" id="save-task-btn">
                        <i class="fas fa-save"></i>
                        <span id="save-task-btn-text">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</span>
                    </button>
                    <button class="btn btn-danger" id="delete-task-btn" style="display: none;">
                        <i class="fas fa-trash"></i>
                        <span>–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</span>
                    </button>
                </div>
                
                <div class="form-group" style="margin-top: 24px;">
                    <label class="form-label">–í—Å–µ –∑–∞–¥–∞–Ω–∏—è (–≤—Å–µ–≥–æ: <span id="admin-tasks-count">0</span>)</label>
                    <div id="admin-tasks-list" style="max-height: 250px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: 10px; background: var(--bg-tertiary);">
                    </div>
                </div>
            </div>
            
            <div class="admin-content" id="admin-exams-tab">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞</label>
                    <input type="text" class="form-input" id="admin-exam-title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–æ–±–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç #1">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞</label>
                    <textarea class="form-textarea" id="admin-exam-description" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç, –µ–≥–æ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞–Ω–∏–π –≤ –≤–∞—Ä–∏–∞–Ω—Ç–µ</label>
                    <input type="number" class="form-input" id="admin-exam-tasks-count" min="1" max="27" value="10">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–í—Ä–µ–º—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (–º–∏–Ω—É—Ç)</label>
                    <input type="number" class="form-input" id="admin-exam-time" min="5" max="240" value="60">
                </div>
                
                <div class="admin-buttons">
                    <button class="btn btn-exam" id="save-exam-btn">
                        <i class="fas fa-save"></i>
                        <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç</span>
                    </button>
                </div>
                
                <div class="form-group" style="margin-top: 24px;">
                    <label class="form-label">–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã (–≤—Å–µ–≥–æ: <span id="admin-exams-count">0</span>)</label>
                    <div id="admin-exams-list" style="max-height: 250px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: 10px; background: var(--bg-tertiary);">
                    </div>
                </div>
            </div>
            
            <div class="admin-content" id="admin-theory-tab">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ —Ç–µ–æ—Ä–∏–∏</label>
                    <input type="text" class="form-input" id="admin-theory-title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—è - –ø—Ä–∞–≤–æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏—Å—Ç–∞–≤–æ–∫">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞</label>
                    <textarea class="form-textarea" id="admin-theory-content" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Ç–µ–æ—Ä–∏–∏..."></textarea>
                </div>
                
                <div class="admin-buttons">
                    <button class="btn btn-primary" id="save-theory-btn">
                        <i class="fas fa-save"></i>
                        <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–æ—Ä–∏—é</span>
                    </button>
                </div>
                
                <div class="form-group" style="margin-top: 24px;">
                    <label class="form-label">–í—Å–µ —Ä–∞–∑–¥–µ–ª—ã —Ç–µ–æ—Ä–∏–∏</label>
                    <div id="admin-theory-list" style="max-height: 180px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: 10px; background: var(--bg-tertiary);">
                    </div>
                </div>
            </div>
            
            <div class="admin-content" id="admin-users-tab">
                <div class="form-group">
                    <label class="form-label">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</label>
                    <div style="background: var(--bg-tertiary); padding: 14px; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <div>
                                <div style="font-size: 22px; font-weight: 700; color: var(--accent-primary);" id="total-users">0</div>
                                <div style="font-size: 11px; color: var(--text-muted);">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                            </div>
                            <div>
                                <div style="font-size: 22px; font-weight: 700; color: var(--success-color);" id="active-today">0</div>
                                <div style="font-size: 11px; color: var(--text-muted);">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <div style="background: var(--bg-tertiary); padding: 14px; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                        <button class="btn btn-danger" id="reset-user-btn" style="width: 100%;">
                            <i class="fas fa-trash"></i>
                            <span>–°–±—Ä–æ—Å–∏—Ç—å –º–æ–∏ –¥–∞–Ω–Ω—ã–µ</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="admin-content" id="admin-sync-tab">
                <div class="form-group">
                    <label class="form-label">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</label>
                    <div style="background: var(--bg-tertiary); padding: 14px; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                        <button class="btn btn-primary" id="force-sync-btn" style="width: 100%;">
                            <i class="fas fa-sync"></i>
                            <span>–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</span>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</label>
                    <div style="background: var(--bg-tertiary); padding: 14px; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                        <div style="margin-bottom: 6px;">
                            <div style="font-size: 11px; color: var(--text-muted);">–ó–∞–¥–∞–Ω–∏—è</div>
                            <div style="font-size: 14px; font-weight: 700; color: var(--accent-primary);" id="sync-tasks-status">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0</div>
                        </div>
                        
                        <div style="margin-bottom: 6px;">
                            <div style="font-size: 11px; color: var(--text-muted);">–ü—Ä–æ–±–Ω–∏–∫–∏</div>
                            <div style="font-size: 14px; font-weight: 700; color: var(--exam-color);" id="sync-exams-status">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0</div>
                        </div>
                        
                        <div style="margin-bottom: 6px;">
                            <div style="font-size: 11px; color: var(--text-muted);">–¢–µ–æ—Ä–∏—è</div>
                            <div style="font-size: 14px; font-weight: 700; color: var(--success-color);" id="sync-theory-status">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="auth-modal" id="auth-modal">
            <div class="auth-container">
                <div class="auth-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <h2 class="auth-title">–î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</h2>
                <p class="auth-subtitle">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</p>
                
                <div class="auth-error" id="auth-error"></div>
                
                <input type="password" class="auth-input" id="admin-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="20">
                
                <div class="buttons-row">
                    <button class="btn btn-primary" id="submit-password">
                        <i class="fas fa-unlock"></i>
                        <span>–í–æ–π—Ç–∏</span>
                    </button>
                    <button class="btn btn-secondary" id="cancel-auth">
                        <span>–û—Ç–º–µ–Ω–∞</span>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="sync-status" id="sync-status">
            <i class="fas fa-sync"></i>
            <span id="sync-text"></span>
        </div>
    </div>

    <script>
// 1. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ):
const CONFIG = {
    ADMIN_PASSWORD: "admin123",
    STORAGE_PREFIX: "ege_russian_",
    DAILY_GOAL: 5,
    SYNC_INTERVAL: 30000,
    DEFAULT_BOT_TOKEN: "8015597915:AAFOxZ0c7aIZErWmS7jeSLoiIdTbzGBrqKA",
    DEFAULT_ADMIN_CHAT_ID: "1527919061"
};

let tg = null;
let userId = null;
let botToken = CONFIG.DEFAULT_BOT_TOKEN;
let adminChatId = CONFIG.DEFAULT_ADMIN_CHAT_ID;
let BOT_API_URL = `https://api.telegram.org/bot${botToken}`;

        const AppData = {
            tasks: [],
            exams: [],
            theory: [],
            stats: {
                totalAttempts: 0,
                correctAttempts: 0,
                solvedTasks: [],
                favoriteTasks: [],
                solvedExams: [],
                examScores: {},
                lastActive: new Date().toISOString(),
                streak: 0,
                lastStreakDate: new Date().toISOString(),
                dailyProgress: 0,
                dailyDate: new Date().toISOString().split('T')[0]
            },
            achievements: {},
            currentTask: null,
            currentExam: null,
            currentExamTasks: [],
            currentExamIndex: 0,
            examTimer: null,
            examTimeLeft: 0,
            examCorrectAnswers: 0,
            selectedOptions: {},
            isAdminAuthenticated: false,
            editingTaskId: null,
            editingExamId: null,
            lastSyncTime: 0
        };

        class Utils {
            static normalizeAnswer(answer) {
                if (Array.isArray(answer)) {
                    return answer.map(item => item.toString().toLowerCase().trim()).sort().join(',');
                }
                return answer.toString().toLowerCase().trim().replace(/\s+/g, ' ');
            }

            static formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${minutes}:${secs.toString().padStart(2, '0')}`;
            }

            static showNotification(message, type = 'info') {
                try {
                    if (tg && tg.showAlert && typeof tg.showAlert === 'function') {
                        tg.showAlert(message);
                    } else {
                        alert(message);
                    }
                } catch (e) {
                    alert(message);
                }
            }

            static showSyncStatus(message, type = 'info') {
                const statusElement = document.getElementById('sync-status');
                const textElement = document.getElementById('sync-text');
                
                if (!statusElement || !textElement) return;
                
                statusElement.className = 'sync-status';
                textElement.textContent = message;
                statusElement.style.display = 'flex';
                
                if (type !== 'syncing') {
                    setTimeout(() => {
                        statusElement.style.display = 'none';
                    }, 3000);
                }
            }

            static updateSyncStatus(type, count) {
                const elements = {
                    tasks: document.getElementById('sync-tasks-status'),
                    exams: document.getElementById('sync-exams-status'),
                    theory: document.getElementById('sync-theory-status')
                };
                
                if (elements[type]) {
                    elements[type].textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${count}`;
                }
            }
        }

        class StorageManager {
            static getStorageKey(key) {
                return CONFIG.STORAGE_PREFIX + userId + '_' + key;
            }

            static saveUserData() {
                try {
                    localStorage.setItem(
                        this.getStorageKey('stats'),
                        JSON.stringify(AppData.stats)
                    );
                    localStorage.setItem(
                        this.getStorageKey('achievements'),
                        JSON.stringify(AppData.achievements)
                    );
                    return true;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', e);
                    return false;
                }
            }

            static loadUserData() {
                try {
                    const statsKey = this.getStorageKey('stats');
                    const achievementsKey = this.getStorageKey('achievements');
                    
                    const savedStats = localStorage.getItem(statsKey);
                    const savedAchievements = localStorage.getItem(achievementsKey);
                    
                    if (savedStats) {
                        const loadedStats = JSON.parse(savedStats);
                        const today = new Date().toISOString().split('T')[0];
                        
                        if (loadedStats.dailyDate !== today) {
                            loadedStats.dailyProgress = 0;
                            loadedStats.dailyDate = today;
                        }
                        
                        this.updateStreakLogic(loadedStats);
                        AppData.stats = loadedStats;
                    }
                    
                    if (savedAchievements) {
                        AppData.achievements = JSON.parse(savedAchievements);
                    } else {
                        AppData.achievements = this.getInitialAchievements();
                    }
                    
                    return true;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', e);
                    return false;
                }
            }

            static saveAppData(key, data) {
                try {
                    localStorage.setItem(CONFIG.STORAGE_PREFIX + key, JSON.stringify(data));
                    return true;
                } catch (e) {
                    console.error(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è ${key}:`, e);
                    return false;
                }
            }

            static loadAppData(key) {
                try {
                    const data = localStorage.getItem(CONFIG.STORAGE_PREFIX + key);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${key}:`, e);
                    return null;
                }
            }

            static updateStreakLogic(statsData) {
                const lastActive = new Date(statsData.lastActive);
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const lastActiveDate = new Date(lastActive.getFullYear(), lastActive.getMonth(), lastActive.getDate());
                
                const diffDays = Math.floor((today - lastActiveDate) / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) {
                    return;
                } else if (diffDays === 1) {
                    statsData.streak++;
                } else if (diffDays > 1) {
                    statsData.streak = 0;
                }
                
                statsData.lastActive = now.toISOString();
                statsData.lastStreakDate = now.toISOString();
            }

            static getInitialAchievements() {
                return {
                    first_blood: { unlocked: false, progress: 0, max: 1, title: "–ü–µ—Ä–≤–∞—è –∫—Ä–æ–≤—å", desc: "–†–µ—à–∏—Ç–µ –ø–µ—Ä–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ" },
                    master: { unlocked: false, progress: 0, max: 10, title: "–ú–∞—Å—Ç–µ—Ä —Å–ª–æ–≤–∞", desc: "–†–µ—à–∏—Ç–µ 10 –∑–∞–¥–∞–Ω–∏–π" },
                    perfectionist: { unlocked: false, progress: 0, max: 50, title: "–ü–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç", desc: "–†–µ—à–∏—Ç–µ 50 –∑–∞–¥–∞–Ω–∏–π" },
                    accurate: { unlocked: false, progress: 0, max: 80, title: "–°–Ω–∞–π–ø–µ—Ä", desc: "–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 80% —Ç–æ—á–Ω–æ—Å—Ç–∏" },
                    daily_streak: { unlocked: false, progress: 0, max: 7, title: "–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞", desc: "–ó–∞–Ω–∏–º–∞–π—Ç–µ—Å—å 7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥" },
                    favorite: { unlocked: false, progress: 0, max: 5, title: "–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä", desc: "–î–æ–±–∞–≤—å—Ç–µ 5 –∑–∞–¥–∞–Ω–∏–π –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ" },
                    theorist: { unlocked: false, progress: 0, max: 8, title: "–¢–µ–æ—Ä–µ—Ç–∏–∫", desc: "–ò–∑—É—á–∏—Ç–µ –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã —Ç–µ–æ—Ä–∏–∏" },
                    speedrunner: { unlocked: false, progress: 0, max: 5, title: "–°–ø–∏–¥—Ä–∞–Ω–Ω–µ—Ä", desc: "–†–µ—à–∏—Ç–µ 5 –∑–∞–¥–∞–Ω–∏–π –ø–æ–¥—Ä—è–¥ –±–µ–∑ –æ—à–∏–±–æ–∫" },
                    grammar_guru: { unlocked: false, progress: 0, max: 15, title: "–ì—É—Ä—É –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏", desc: "–†–µ—à–∏—Ç–µ 15 –∑–∞–¥–∞–Ω–∏–π –ø–æ –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏–∏" },
                    punctuation_pro: { unlocked: false, progress: 0, max: 10, title: "–ü—Ä–æ—Ñ–∏ –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏", desc: "–†–µ—à–∏—Ç–µ 10 –∑–∞–¥–∞–Ω–∏–π –ø–æ –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏" },
                    exam_ready: { unlocked: false, progress: 0, max: 27, title: "–ì–æ—Ç–æ–≤ –∫ –ï–ì–≠", desc: "–†–µ—à–∏—Ç–µ –ø–æ –æ–¥–Ω–æ–º—É –∑–∞–¥–∞–Ω–∏—é –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞" },
                    exam_master: { unlocked: false, progress: 0, max: 3, title: "–ú–∞—Å—Ç–µ—Ä –ø—Ä–æ–±–Ω–∏–∫–æ–≤", desc: "–ü—Ä–æ–π–¥–∏—Ç–µ 3 –ø—Ä–æ–±–Ω–∏–∫–∞" },
                    all_star: { unlocked: false, progress: 0, max: 100, title: "–í—Å–µ –∑–≤—ë–∑–¥—ã", desc: "–†–µ—à–∏—Ç–µ 100 –∑–∞–¥–∞–Ω–∏–π" }
                };
            }

            static resetUserData() {
                AppData.stats = {
                    totalAttempts: 0,
                    correctAttempts: 0,
                    solvedTasks: [],
                    favoriteTasks: [],
                    solvedExams: [],
                    examScores: {},
                    lastActive: new Date().toISOString(),
                    streak: 0,
                    lastStreakDate: new Date().toISOString(),
                    dailyProgress: 0,
                    dailyDate: new Date().toISOString().split('T')[0]
                };
                
                AppData.achievements = this.getInitialAchievements();
                this.saveUserData();
                
                UI.updateStatsDisplay();
                UI.updateDailyProgress();
                UI.updateStreak();
                UI.renderAchievements();
                
                Utils.showNotification('–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã', 'info');
            }
        }

// 2. –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ö–õ–ê–°–° BotAPI:
class BotAPI {
    static async saveDataToBot(key, data) {
        if (!botToken) {
            console.error('‚ùå –û–®–ò–ë–ö–ê: –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –ø—É—Å—Ç–æ–π!');
            return false;
        }
        
        try {
            const message = `DATA_${key}:${JSON.stringify(data)}`;
            
            const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    chat_id: adminChatId,
                    text: message
                })
            });
            
            const result = await response.json();
            
            if (result.ok) {
                console.log(`‚úÖ –î–∞–Ω–Ω—ã–µ "${key}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±–æ—Ç–µ!`);
                return true;
            } else {
                console.error(`‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:`, result.description);
                return false;
            }
            
        } catch (error) {
            console.error('‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞:', error);
            return false;
        }
    }

    static async loadDataFromBot(key) {
        if (!botToken) {
            console.error('‚ùå –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –∑–∞–¥–∞–Ω!');
            return null;
        }
        
        try {
            const response = await fetch(`https://api.telegram.org/bot${botToken}/getUpdates?offset=0&limit=100`);
            
            if (!response.ok) return null;
            
            const data = await response.json();
            
            if (!data.ok) return null;
            
            const messages = data.result || [];
            
            for (let i = messages.length - 1; i >= 0; i--) {
                const msg = messages[i].message;
                if (msg && msg.text && msg.text.includes(`DATA_${key}:`)) {
                    try {
                        const startIndex = msg.text.indexOf(`DATA_${key}:`) + `DATA_${key}:`.length;
                        const jsonString = msg.text.substring(startIndex);
                        return JSON.parse(jsonString);
                    } catch (e) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', e);
                    }
                }
            }
            
            return null;
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
            return null;
        }
    }
}

        class SyncManager {
            static async syncAllData() {
                if (!botToken || botToken === CONFIG.DEFAULT_BOT_TOKEN) return false;
                
                Utils.showSyncStatus('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...', 'syncing');
                
                try {
                    let changed = false;
                    
                    const [botTasks, botExams, botTheory] = await Promise.all([
                        BotAPI.loadDataFromBot('tasks'),
                        BotAPI.loadDataFromBot('exams'),
                        BotAPI.loadDataFromBot('theory')
                    ]);
                    
                    const savedTasks = StorageManager.loadAppData('tasks') || [];
                    const savedExams = StorageManager.loadAppData('exams') || [];
                    const savedTheory = StorageManager.loadAppData('theory') || [];
                    
                    if (botTasks && Array.isArray(botTasks) && botTasks.length > 0) {
                        AppData.tasks = botTasks;
                        StorageManager.saveAppData('tasks', AppData.tasks);
                        changed = true;
                    } else if (savedTasks.length > 0) {
                        AppData.tasks = savedTasks;
                    }
                    
                    if (botExams && Array.isArray(botExams) && botExams.length > 0) {
                        AppData.exams = botExams;
                        StorageManager.saveAppData('exams', AppData.exams);
                        changed = true;
                    } else if (savedExams.length > 0) {
                        AppData.exams = savedExams;
                    }
                    
                    if (botTheory && Array.isArray(botTheory) && botTheory.length > 0) {
                        AppData.theory = botTheory;
                        StorageManager.saveAppData('theory', AppData.theory);
                        changed = true;
                    } else if (savedTheory.length > 0) {
                        AppData.theory = savedTheory;
                    }
                    
                    AppData.lastSyncTime = Date.now();
                    
                    if (changed) {
                        Utils.showSyncStatus('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
                        UI.updateStatsDisplay();
                        UI.renderTasksList();
                        UI.renderExamsList();
                        UI.renderTheory();
                        UI.updateNewTasksBadge();
                        UI.updateNewExamsBadge();
                    } else {
                        setTimeout(() => {
                            const syncStatus = document.getElementById('sync-status');
                            if (syncStatus) syncStatus.style.display = 'none';
                        }, 1000);
                    }
                    
                    Utils.updateSyncStatus('tasks', AppData.tasks.length);
                    Utils.updateSyncStatus('exams', AppData.exams.length);
                    Utils.updateSyncStatus('theory', AppData.theory.length);
                    
                    return changed;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', error);
                    Utils.showSyncStatus('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏', 'error');
                    return false;
                }
            }

            static async syncUserData() {
                try {
                    const userData = {
                        userId: userId,
                        stats: AppData.stats,
                        lastActive: new Date().toISOString()
                    };
                    
                    let usersData = await BotAPI.loadDataFromBot('users') || [];
                    const userIndex = usersData.findIndex(u => u.userId === userId);
                    
                    if (userIndex !== -1) {
                        usersData[userIndex] = userData;
                    } else {
                        usersData.push(userData);
                    }
                    
                    await BotAPI.saveDataToBot('users', usersData);
                    
                    if (AppData.isAdminAuthenticated) {
                        AdminUI.updateUsersStats(usersData);
                    }
                    
                    return true;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö:', error);
                    return false;
                }
            }

            static startAutoSync() {
                const autoSyncElement = document.getElementById('auto-sync-enabled');
                if (autoSyncElement && !autoSyncElement.checked) return;
                
                this.syncAllData();
                
                setInterval(async () => {
                    const checkElement = document.getElementById('auto-sync-enabled');
                    if (checkElement && checkElement.checked) {
                        await this.syncAllData();
                    }
                }, CONFIG.SYNC_INTERVAL);
            }

            static async forceSync() {
                Utils.showSyncStatus('–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...', 'syncing');
                const result = await this.syncAllData();
                return result;
            }
        }

        class UI {
            static updateStatsDisplay() {
                const elements = {
                    totalTasks: document.getElementById('total-tasks'),
                    solvedCount: document.getElementById('solved-count'),
                    correctRate: document.getElementById('correct-rate'),
                    completedTasks: document.getElementById('completed-tasks'),
                    favoriteTasks: document.getElementById('favorite-tasks'),
                    tasksCount: document.getElementById('tasks-count')
                };
                
                if (elements.totalTasks) elements.totalTasks.textContent = AppData.tasks.length;
                if (elements.solvedCount) elements.solvedCount.textContent = AppData.stats.solvedTasks.length;
                
                const accuracy = AppData.stats.totalAttempts > 0 
                    ? Math.round((AppData.stats.correctAttempts / AppData.stats.totalAttempts) * 100)
                    : 0;
                if (elements.correctRate) elements.correctRate.textContent = `${accuracy}%`;
                
                if (elements.completedTasks) elements.completedTasks.textContent = AppData.stats.solvedTasks.length;
                if (elements.favoriteTasks) elements.favoriteTasks.textContent = AppData.stats.favoriteTasks.length;
                if (elements.tasksCount) elements.tasksCount.textContent = `${AppData.tasks.length} –∑–∞–¥–∞–Ω–∏–π`;
                
                if (AppData.isAdminAuthenticated) {
                    const adminTasksCount = document.getElementById('admin-tasks-count');
                    const adminExamsCount = document.getElementById('admin-exams-count');
                    if (adminTasksCount) adminTasksCount.textContent = AppData.tasks.length;
                    if (adminExamsCount) adminExamsCount.textContent = AppData.exams.length;
                }
            }

            static updateDailyProgress() {
                const progressPercent = Math.min((AppData.stats.dailyProgress / CONFIG.DAILY_GOAL) * 100, 100);
                const progressBar = document.getElementById('daily-progress');
                const dailySolved = document.getElementById('daily-solved');
                
                if (progressBar) progressBar.style.width = `${progressPercent}%`;
                if (dailySolved) dailySolved.textContent = AppData.stats.dailyProgress;
            }

            static updateStreak() {
                const streakDays = document.getElementById('streak-days');
                const streakNext = document.getElementById('streak-next');
                
                if (streakDays) streakDays.textContent = AppData.stats.streak;
                
                if (streakNext) {
                    if (AppData.stats.dailyProgress >= CONFIG.DAILY_GOAL) {
                        streakNext.textContent = "–í—ã–ø–æ–ª–Ω–µ–Ω–æ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è!";
                    } else {
                        streakNext.textContent = `–û—Å—Ç–∞–ª–æ—Å—å ${CONFIG.DAILY_GOAL - AppData.stats.dailyProgress} –∑–∞–¥–∞–Ω–∏–π`;
                    }
                }
            }

            static updateNewTasksBadge() {
                const badge = document.getElementById('new-tasks-badge');
                if (!badge) return;
                
                const newTasksCount = AppData.tasks.length - AppData.stats.solvedTasks.length;
                
                if (newTasksCount > 0) {
                    badge.textContent = newTasksCount > 9 ? '9+' : newTasksCount;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            }

            static updateNewExamsBadge() {
                const badge = document.getElementById('new-exams-badge');
                if (!badge) return;
                
                const newExamsCount = AppData.exams.length - AppData.stats.solvedExams.length;
                
                if (newExamsCount > 0) {
                    badge.textContent = newExamsCount > 9 ? '9+' : newExamsCount;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            }

            static showRandomTask() {
                if (AppData.tasks.length === 0) {
                    const taskText = document.getElementById('task-text');
                    if (taskText) taskText.textContent = "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π.";
                    return;
                }
                
                const unsolvedTasks = AppData.tasks.filter(task => !AppData.stats.solvedTasks.includes(task.id));
                const availableTasks = unsolvedTasks.length > 0 ? unsolvedTasks : AppData.tasks;
                const randomIndex = Math.floor(Math.random() * availableTasks.length);
                AppData.currentTask = availableTasks[randomIndex];
                
                const elements = {
                    taskNumber: document.getElementById('task-number'),
                    taskTheme: document.getElementById('task-theme'),
                    taskText: document.getElementById('task-text'),
                    answerInput: document.getElementById('answer-input'),
                    resultContainer: document.getElementById('result-container')
                };
                
                if (elements.taskNumber) elements.taskNumber.textContent = `–ó–∞–¥–∞–Ω–∏–µ #${AppData.currentTask.number}`;
                if (elements.taskTheme) elements.taskTheme.textContent = AppData.currentTask.theme;
                if (elements.taskText) elements.taskText.innerHTML = AppData.currentTask.text;
                if (elements.answerInput) elements.answerInput.value = '';
                if (elements.resultContainer) elements.resultContainer.innerHTML = '';
                
                this.updateFavoriteButton();
                this.renderTaskOptions();
            }

            static renderTaskOptions() {
                const container = document.getElementById('options-container');
                const answerInput = document.getElementById('answer-input');
                
                if (!container) return;
                
                container.innerHTML = '';
                AppData.selectedOptions = {};
                
                if (AppData.currentTask.options && AppData.currentTask.type === 'single') {
                    if (answerInput) answerInput.style.display = 'none';
                    
                    AppData.currentTask.options.forEach((option, index) => {
                        const optionElement = document.createElement('div');
                        optionElement.className = 'option';
                        optionElement.innerHTML = `
                            <div class="option-marker">${String.fromCharCode(65 + index)}</div>
                            <div class="option-text">${option}</div>
                        `;
                        
                        optionElement.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            document.querySelectorAll('#options-container .option').forEach(opt => {
                                opt.classList.remove('selected');
                            });
                            optionElement.classList.add('selected');
                            AppData.selectedOptions[AppData.currentTask.id] = option;
                        });
                        
                        optionElement.addEventListener('touchstart', (e) => {
                            e.preventDefault();
                            e.currentTarget.click();
                        }, { passive: false });
                        
                        container.appendChild(optionElement);
                    });
                } else if (AppData.currentTask.type === 'multiple') {
                    if (answerInput) answerInput.style.display = 'none';
                    
                    AppData.currentTask.options.forEach((option, index) => {
                        const optionElement = document.createElement('div');
                        optionElement.className = 'option';
                        optionElement.innerHTML = `
                            <div class="option-marker">${String.fromCharCode(65 + index)}</div>
                            <div class="option-text">${option}</div>
                        `;
                        
                        optionElement.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            optionElement.classList.toggle('selected');
                            
                            if (!AppData.selectedOptions[AppData.currentTask.id]) {
                                AppData.selectedOptions[AppData.currentTask.id] = [];
                            }
                            
                            const selectedIndex = AppData.selectedOptions[AppData.currentTask.id].indexOf(option);
                            if (selectedIndex === -1) {
                                AppData.selectedOptions[AppData.currentTask.id].push(option);
                            } else {
                                AppData.selectedOptions[AppData.currentTask.id].splice(selectedIndex, 1);
                            }
                        });
                        
                        optionElement.addEventListener('touchstart', (e) => {
                            e.preventDefault();
                            e.currentTarget.click();
                        }, { passive: false });
                        
                        container.appendChild(optionElement);
                    });
                } else {
                    if (answerInput) {
                        answerInput.style.display = 'block';
                        answerInput.placeholder = AppData.currentTask.type === 'number' 
                            ? "–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 5)" 
                            : "–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç...";
                    }
                }
            }

            static updateFavoriteButton() {
                const favoriteBtn = document.getElementById('favorite-btn');
                if (!favoriteBtn || !AppData.currentTask) return;
                
                const icon = favoriteBtn.querySelector('i');
                
                if (AppData.stats.favoriteTasks.includes(AppData.currentTask.id)) {
                    icon.className = 'fas fa-star';
                    favoriteBtn.style.color = 'var(--warning-color)';
                } else {
                    icon.className = 'far fa-star';
                    favoriteBtn.style.color = '';
                }
            }

            static showResult(isCorrect, userAnswer, correctAnswer) {
                const resultContainer = document.getElementById('result-container');
                if (!resultContainer) return;
                
                if (isCorrect) {
                    resultContainer.innerHTML = `
                        <div class="result correct">
                            <div class="result-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="result-title">–ü—Ä–∞–≤–∏–ª—å–Ω–æ!</div>
                            <div class="result-desc">–í—ã –æ—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å —Å –∑–∞–¥–∞–Ω–∏–µ–º</div>
                            <div class="result-answer">–í–∞—à –æ—Ç–≤–µ—Ç: ${Array.isArray(userAnswer) ? userAnswer.join(', ') : userAnswer}</div>
                        </div>
                    `;
                } else {
                    resultContainer.innerHTML = `
                        <div class="result incorrect">
                            <div class="result-icon">
                                <i class="fas fa-times-circle"></i>
                            </div>
                            <div class="result-title">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ</div>
                            <div class="result-desc">–ò–∑—É—á–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–æ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞</div>
                            <div class="result-answer">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${Array.isArray(correctAnswer) ? correctAnswer.join(', ') : correctAnswer}</div>
                        </div>
                    `;
                }
            }

            static renderTasksList() {
                const container = document.getElementById('tasks-list-container');
                if (!container) return;
                
                if (AppData.tasks.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-tasks"></i>
                            </div>
                            <div class="empty-title">–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π</div>
                            <p>–ù–∞—á–Ω–∏—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É!</p>
                        </div>
                    `;
                    return;
                }
                
                const tasksByTheme = {};
                AppData.tasks.forEach(task => {
                    if (!tasksByTheme[task.theme]) {
                        tasksByTheme[task.theme] = [];
                    }
                    tasksByTheme[task.theme].push(task);
                });
                
                let html = '';
                for (const theme in tasksByTheme) {
                    html += `
                        <div class="task-card" style="margin-top: 10px;">
                            <div class="task-header">
                                <div>
                                    <div class="task-number">${theme}</div>
                                    <div class="task-theme">${tasksByTheme[theme].length} –∑–∞–¥–∞–Ω–∏–π</div>
                                </div>
                            </div>
                            <div class="options-container">
                    `;
                    
                    tasksByTheme[theme].forEach(task => {
                        const isSolved = AppData.stats.solvedTasks.includes(task.id);
                        const isFavorite = AppData.stats.favoriteTasks.includes(task.id);
                        
                        html += `
                            <div class="option ${isSolved ? 'selected' : ''}" data-task-id="${task.id}">
                                <div class="option-marker">${task.number}</div>
                                <div class="option-text">
                                    ${task.text.substring(0, 50)}${task.text.length > 50 ? '...' : ''}
                                    ${isFavorite ? '<i class="fas fa-star" style="color: var(--warning-color); margin-left: 5px;"></i>' : ''}
                                </div>
                                ${isSolved ? '<i class="fas fa-check" style="color: var(--success-color);"></i>' : ''}
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
                
                container.innerHTML = html;
                
                container.querySelectorAll('.option[data-task-id]').forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const taskId = parseInt(this.getAttribute('data-task-id'));
                        const task = AppData.tasks.find(t => t.id === taskId);
                        
                        if (task) {
                            UI.switchTab('practice');
                            AppData.currentTask = task;
                            UI.showRandomTask();
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        }
                    });
                    
                    item.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        e.currentTarget.click();
                    }, { passive: false });
                });
            }

            static renderExamsList() {
                const container = document.getElementById('exams-grid');
                const countElement = document.getElementById('exams-count');
                
                if (!container || !countElement) return;
                
                if (AppData.exams.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <div class="empty-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="empty-title">–ù–µ—Ç –ø—Ä–æ–±–Ω–∏–∫–æ–≤</div>
                            <p>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–∏—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</p>
                        </div>
                    `;
                    countElement.textContent = '0 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤';
                    return;
                }
                
                let html = '';
                AppData.exams.forEach(exam => {
                    const isSolved = AppData.stats.solvedExams.includes(exam.id);
                    const score = AppData.stats.examScores[exam.id] || 0;
                    const progressPercent = isSolved ? 100 : 0;
                    
                    html += `
                        <div class="exam-variant" data-exam-id="${exam.id}">
                            <div class="exam-variant-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="exam-variant-title">${exam.title}</div>
                            <div class="exam-variant-desc">${exam.description}</div>
                            <div class="exam-variant-progress">
                                <div class="exam-variant-progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                            <div class="exam-variant-stats">
                                <span>${exam.tasksCount} –∑–∞–¥–∞–Ω–∏–π</span>
                                <span>${exam.time} –º–∏–Ω</span>
                                ${isSolved ? `<span>${score}%</span>` : '<span>–ù–µ –Ω–∞—á–∞—Ç</span>'}
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                countElement.textContent = `${AppData.exams.length} –≤–∞—Ä–∏–∞–Ω—Ç${AppData.exams.length % 10 === 1 && AppData.exams.length % 100 !== 11 ? '' : AppData.exams.length % 10 >= 2 && AppData.exams.length % 10 <= 4 && (AppData.exams.length % 100 < 10 || AppData.exams.length % 100 >= 20) ? '–∞' : '–æ–≤'}`;
                
                container.querySelectorAll('.exam-variant').forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const examId = parseInt(this.getAttribute('data-exam-id'));
                        GameLogic.startExam(examId);
                    });
                    
                    item.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        e.currentTarget.click();
                    }, { passive: false });
                });
            }

            static renderTheory() {
                const container = document.getElementById('theory-content-container');
                if (!container) return;
                
                if (AppData.theory.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="empty-title">–¢–µ–æ—Ä–∏—è —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è</div>
                            <p>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–∏—Ç –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                AppData.theory.forEach((section, index) => {
                    html += `
                        <div class="theory-section">
                            <div class="theory-header">
                                <div class="theory-icon">
                                    <i class="fas fa-book-open"></i>
                                </div>
                                <div class="theory-title">${section.title}</div>
                            </div>
                            <div class="theory-content">
                                ${section.content}
                            </div>
                            <div style="text-align: center; margin-top: 12px;">
                                <button class="btn btn-secondary practice-theory-btn" data-theme="${section.title.split(':')[0]}">
                                    <i class="fas fa-play-circle"></i>
                                    <span>–ü–æ—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å</span>
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
                container.querySelectorAll('.practice-theory-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const theme = this.getAttribute('data-theme');
                        UI.switchTab('practice');
                        
                        const themeTasks = AppData.tasks.filter(t => t.theme.includes(theme));
                        if (themeTasks.length > 0) {
                            const randomTask = themeTasks[Math.floor(Math.random() * themeTasks.length)];
                            AppData.currentTask = randomTask;
                            UI.showRandomTask();
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        }
                    });
                    
                    btn.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        e.currentTarget.click();
                    }, { passive: false });
                });
            }

            static renderAchievements() {
                const container = document.getElementById('achievements-grid');
                const countElement = document.getElementById('achievements-count');
                
                if (!container || !countElement) return;
                
                let unlockedCount = 0;
                let totalCount = 0;
                
                let html = '';
                
                for (const key in AppData.achievements) {
                    const achievement = AppData.achievements[key];
                    totalCount++;
                    
                    if (achievement.unlocked) {
                        unlockedCount++;
                    }
                    
                    const progressPercent = (achievement.progress / achievement.max) * 100;
                    
                    html += `
                        <div class="achievement ${achievement.unlocked ? 'unlocked' : 'locked'}">
                            <div class="achievement-badge">
                                <i class="fas fa-${achievement.unlocked ? 'trophy' : 'lock'}"></i>
                            </div>
                            <div class="achievement-title">${achievement.title}</div>
                            <div class="achievement-desc">${achievement.desc}</div>
                            ${!achievement.unlocked ? `
                                <div class="achievement-progress">
                                    <div class="achievement-progress-fill" style="width: ${progressPercent}%"></div>
                                </div>
                                <div style="font-size: 9px; color: var(--text-muted); margin-top: 3px;">
                                    ${achievement.progress}/${achievement.max}
                                </div>
                            ` : ''}
                        </div>
                    `;
                }
                
                container.innerHTML = html;
                countElement.textContent = `${unlockedCount}/${totalCount}`;
            }

            static switchTab(tabName) {
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                const activeBtn = document.querySelector(`.nav-btn[data-tab="${tabName}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }
                
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                const activeTab = document.getElementById(`${tabName}-tab`);
                if (activeTab) {
                    activeTab.classList.add('active');
                }
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            static switchAdminTab(tabName) {
                document.querySelectorAll('.admin-tab').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                const activeBtn = document.querySelector(`.admin-tab[data-admin-tab="${tabName}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }
                
                document.querySelectorAll('.admin-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                const activeTab = document.getElementById(`admin-${tabName}-tab`);
                if (activeTab) {
                    activeTab.classList.add('active');
                }
            }
        }

        class GameLogic {
            static checkAnswer() {
                if (!AppData.currentTask) return;
                
                let userAnswer;
                
                if (AppData.currentTask.type === 'single' || AppData.currentTask.type === 'multiple') {
                    userAnswer = AppData.selectedOptions[AppData.currentTask.id];
                    if (!userAnswer || (Array.isArray(userAnswer) && userAnswer.length === 0)) {
                        Utils.showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞', 'error');
                        return;
                    }
                } else {
                    const answerInput = document.getElementById('answer-input');
                    if (!answerInput) return;
                    userAnswer = answerInput.value.trim();
                    if (!userAnswer) {
                        Utils.showNotification('–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç', 'error');
                        return;
                    }
                }
                
                AppData.stats.totalAttempts++;
                
                let isCorrect = false;
                
                if (AppData.currentTask.type === 'single') {
                    isCorrect = Utils.normalizeAnswer(userAnswer) === Utils.normalizeAnswer(AppData.currentTask.answer);
                } else if (AppData.currentTask.type === 'multiple') {
                    if (Array.isArray(userAnswer) && Array.isArray(AppData.currentTask.answer)) {
                        const userAnswers = userAnswer.map(ans => Utils.normalizeAnswer(ans)).sort();
                        const correctAnswers = AppData.currentTask.answer.map(ans => Utils.normalizeAnswer(ans)).sort();
                        isCorrect = JSON.stringify(userAnswers) === JSON.stringify(correctAnswers);
                    } else if (typeof AppData.currentTask.answer === 'string') {
                        const userAnswers = userAnswer.map(ans => Utils.normalizeAnswer(ans)).sort();
                        const correctAnswers = AppData.currentTask.answer.split(',').map(ans => Utils.normalizeAnswer(ans.trim())).sort();
                        isCorrect = JSON.stringify(userAnswers) === JSON.stringify(correctAnswers);
                    }
                } else if (AppData.currentTask.type === 'number') {
                    const userNum = parseFloat(userAnswer.replace(',', '.'));
                    const correctNum = parseFloat(AppData.currentTask.answer);
                    isCorrect = !isNaN(userNum) && !isNaN(correctNum) && userNum === correctNum;
                } else {
                    isCorrect = Utils.normalizeAnswer(userAnswer) === Utils.normalizeAnswer(AppData.currentTask.answer);
                }
                
                if (isCorrect) {
                    AppData.stats.correctAttempts++;
                    AppData.stats.dailyProgress++;
                    
                    StorageManager.updateStreakLogic(AppData.stats);
                    
                    if (!AppData.stats.solvedTasks.includes(AppData.currentTask.id)) {
                        AppData.stats.solvedTasks.push(AppData.currentTask.id);
                        this.updateAchievement('first_blood', 1);
                        this.updateAchievement('master', AppData.stats.solvedTasks.length);
                        this.updateAchievement('perfectionist', AppData.stats.solvedTasks.length);
                        this.updateAchievement('all_star', AppData.stats.solvedTasks.length);
                    }
                    
                    UI.showResult(true, userAnswer, AppData.currentTask.answer);
                    Utils.showNotification('–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!', 'success');
                } else {
                    UI.showResult(false, userAnswer, AppData.currentTask.answer);
                    Utils.showNotification('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ò–∑—É—á–∏—Ç–µ —Ç–µ–æ—Ä–∏—é –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.', 'error');
                }
                
                UI.updateDailyProgress();
                UI.updateStreak();
                UI.updateStatsDisplay();
                StorageManager.saveUserData();
                SyncManager.syncUserData();
            }

            static showHint() {
                if (!AppData.currentTask || !AppData.currentTask.hint) {
                    Utils.showNotification('–î–ª—è —ç—Ç–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –Ω–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏', 'info');
                    return;
                }
                
                Utils.showNotification(AppData.currentTask.hint, 'info');
            }

            static toggleFavorite() {
                if (!AppData.currentTask) return;
                
                const index = AppData.stats.favoriteTasks.indexOf(AppData.currentTask.id);
                
                if (index === -1) {
                    AppData.stats.favoriteTasks.push(AppData.currentTask.id);
                    Utils.showNotification('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ', 'success');
                    this.updateAchievement('favorite', AppData.stats.favoriteTasks.length);
                } else {
                    AppData.stats.favoriteTasks.splice(index, 1);
                    Utils.showNotification('–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ', 'info');
                }
                
                UI.updateFavoriteButton();
                StorageManager.saveUserData();
                SyncManager.syncUserData();
            }

            static updateAchievement(key, progress, increment = false) {
                if (!AppData.achievements[key]) return;
                
                if (increment) {
                    AppData.achievements[key].progress += progress;
                } else {
                    AppData.achievements[key].progress = progress;
                }
                
                if (AppData.achievements[key].progress >= AppData.achievements[key].max) {
                    AppData.achievements[key].progress = AppData.achievements[key].max;
                    AppData.achievements[key].unlocked = true;
                    
                    if (!increment || progress > 0) {
                        Utils.showNotification(`–ù–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: ${AppData.achievements[key].title}`, 'success');
                    }
                }
                
                StorageManager.saveUserData();
                UI.renderAchievements();
            }

            static startExam(examId) {
                const exam = AppData.exams.find(e => e.id === examId);
                if (!exam) {
                    Utils.showNotification('–ü—Ä–æ–±–Ω–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                    return;
                }
                
                Utils.showNotification(`–ó–∞–ø—É—Å–∫ –ø—Ä–æ–±–Ω–∏–∫–∞: ${exam.title}`, 'info');
                UI.switchTab('practice');
            }
        }

        class AdminUI {
            static showAdminPanel() {
                if (!AppData.isAdminAuthenticated) {
                    this.showAuthModal();
                    return;
                }
                
                const adminPanel = document.getElementById('admin-panel');
                if (adminPanel) {
                    adminPanel.classList.add('active');
                    this.updateAdminData();
                }
            }

            static closeAdminPanel() {
                const adminPanel = document.getElementById('admin-panel');
                if (adminPanel) {
                    adminPanel.classList.remove('active');
                }
            }

            static updateAdminData() {
                this.renderAdminTasksList();
                this.renderAdminExamsList();
                this.renderAdminTheoryList();
                
                const adminTasksCount = document.getElementById('admin-tasks-count');
                const adminExamsCount = document.getElementById('admin-exams-count');
                
                if (adminTasksCount) adminTasksCount.textContent = AppData.tasks.length;
                if (adminExamsCount) adminExamsCount.textContent = AppData.exams.length;
                
                this.populateEditTaskSelect();
                
                this.loadUsersStats();
            }

            static populateEditTaskSelect() {
                const select = document.getElementById('admin-edit-task-select');
                if (!select) return;
                
                select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ...</option>';
                
                AppData.tasks.forEach(task => {
                    const option = document.createElement('option');
                    option.value = task.id;
                    option.textContent = `#${task.number} - ${task.theme}: ${task.text.substring(0, 40)}${task.text.length > 40 ? '...' : ''}`;
                    select.appendChild(option);
                });
            }

            static enableEditMode(taskId) {
                AppData.editingTaskId = taskId;
                const task = AppData.tasks.find(t => t.id === taskId);
                
                if (!task) return;
                
                const elements = {
                    number: document.getElementById('admin-task-number'),
                    theme: document.getElementById('admin-task-theme'),
                    text: document.getElementById('admin-task-text'),
                    type: document.getElementById('admin-task-type'),
                    answer: document.getElementById('admin-task-answer'),
                    hint: document.getElementById('admin-task-hint'),
                    options: document.getElementById('admin-task-options')
                };
                
                if (elements.number) elements.number.value = task.number;
                if (elements.theme) elements.theme.value = task.theme;
                if (elements.text) elements.text.value = task.text.replace(/<[^>]*>/g, '');
                if (elements.type) elements.type.value = task.type;
                if (elements.answer) elements.answer.value = Array.isArray(task.answer) ? task.answer.join(', ') : task.answer;
                if (elements.hint) elements.hint.value = task.hint || '';
                if (elements.options) elements.options.value = task.options ? task.options.join('; ') : '';
                
                const saveBtnText = document.getElementById('save-task-btn-text');
                const deleteBtn = document.getElementById('delete-task-btn');
                
                if (saveBtnText) saveBtnText.textContent = '–û–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ';
                if (deleteBtn) deleteBtn.style.display = 'block';
            }

            static disableEditMode() {
                AppData.editingTaskId = null;
                
                const elements = [
                    'admin-task-number',
                    'admin-task-theme',
                    'admin-task-text',
                    'admin-task-type',
                    'admin-task-options',
                    'admin-task-answer',
                    'admin-task-hint'
                ];
                
                elements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        if (id === 'admin-task-number') element.value = 1;
                        else if (id === 'admin-task-theme') element.value = '–û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—è';
                        else if (id === 'admin-task-type') element.value = 'single';
                        else element.value = '';
                    }
                });
                
                const saveBtnText = document.getElementById('save-task-btn-text');
                const deleteBtn = document.getElementById('delete-task-btn');
                
                if (saveBtnText) saveBtnText.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ';
                if (deleteBtn) deleteBtn.style.display = 'none';
                
                const editModeSelect = document.getElementById('admin-edit-mode');
                if (editModeSelect) editModeSelect.value = 'new';
                
                const editGroup = document.getElementById('edit-task-select-group');
                if (editGroup) editGroup.style.display = 'none';
                
                const editSelect = document.getElementById('admin-edit-task-select');
                if (editSelect) editSelect.value = '';
            }

// 4. –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø AdminUI.saveTask:
static async saveTask() {
    const elements = {
        number: document.getElementById('admin-task-number'),
        theme: document.getElementById('admin-task-theme'),
        text: document.getElementById('admin-task-text'),
        type: document.getElementById('admin-task-type'),
        options: document.getElementById('admin-task-options'),
        answer: document.getElementById('admin-task-answer'),
        hint: document.getElementById('admin-task-hint')
    };
    
    const number = parseInt(elements.number.value);
    const theme = elements.theme.value;
    const text = elements.text.value.trim();
    const type = elements.type.value;
    const options = elements.options.value.split(';').map(opt => opt.trim()).filter(opt => opt);
    const answer = elements.answer.value.trim();
    const hint = elements.hint.value.trim();
    
    if (!text) {
        Utils.showNotification('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è', 'error');
        return;
    }
    
    if (!answer) {
        Utils.showNotification('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç', 'error');
        return;
    }
    
    if (AppData.editingTaskId) {
        const taskIndex = AppData.tasks.findIndex(t => t.id === AppData.editingTaskId);
        if (taskIndex !== -1) {
            AppData.tasks[taskIndex] = {
                ...AppData.tasks[taskIndex],
                number: number,
                theme: theme,
                text: text,
                type: type,
                answer: type === 'multiple' ? answer.split(',').map(a => a.trim()) : answer,
                hint: hint || "–ü–æ–¥—Å–∫–∞–∑–∫–∞ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞",
                updatedAt: Date.now()
            };
            if (type === 'single' || type === 'multiple') {
                AppData.tasks[taskIndex].options = options;
            }
        }
    } else {
        const newTask = {
            id: Date.now(),
            number: number,
            theme: theme,
            text: text,
            type: type,
            answer: type === 'multiple' ? answer.split(',').map(a => a.trim()) : answer,
            hint: hint || "–ü–æ–¥—Å–∫–∞–∑–∫–∞ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞",
            createdAt: Date.now(),
            updatedAt: Date.now()
        };
        
        if (type === 'single' || type === 'multiple') {
            newTask.options = options;
        }
        
        AppData.tasks.push(newTask);
    }
    
    StorageManager.saveAppData('tasks', AppData.tasks);
    
    const syncSuccess = await BotAPI.saveDataToBot('tasks', AppData.tasks);
    
    if (syncSuccess) {
        Utils.showNotification('–ó–∞–¥–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ!', 'success');
        UI.updateStatsDisplay();
        UI.renderTasksList();
        UI.updateNewTasksBadge();
        AdminUI.renderAdminTasksList();
        AdminUI.populateEditTaskSelect();
        AdminUI.disableEditMode();
    }
}

            static async deleteTask() {
                if (!AppData.editingTaskId) return;
                
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ? –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ—Ç–µ—Ä—è—é—Ç –¥–æ—Å—Ç—É–ø –∫ –Ω–µ–º—É.')) {
                    const taskIndex = AppData.tasks.findIndex(t => t.id === AppData.editingTaskId);
                    if (taskIndex !== -1) {
                        AppData.tasks.splice(taskIndex, 1);
                        StorageManager.saveAppData('tasks', AppData.tasks);
                        
                        const deleteSuccess = await BotAPI.saveDataToBot('tasks', AppData.tasks);
                        
                        if (deleteSuccess) {
                            Utils.showNotification('–ó–∞–¥–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ —É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', 'success');
                        } else {
                            await BotAPI.saveDataToBot('tasks', AppData.tasks);
                            Utils.showNotification('–ó–∞–¥–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'success');
                        }
                        
                        UI.updateStatsDisplay();
                        UI.renderTasksList();
                        UI.updateNewTasksBadge();
                        this.renderAdminTasksList();
                        this.disableEditMode();
                    }
                }
            }

            static async saveExam() {
                const elements = {
                    title: document.getElementById('admin-exam-title'),
                    description: document.getElementById('admin-exam-description'),
                    tasksCount: document.getElementById('admin-exam-tasks-count'),
                    time: document.getElementById('admin-exam-time')
                };
                
                const title = elements.title.value.trim();
                const description = elements.description.value.trim();
                const tasksCount = parseInt(elements.tasksCount.value);
                const time = parseInt(elements.time.value);
                
                if (!title) {
                    Utils.showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞', 'error');
                    return;
                }
                
                if (tasksCount < 1 || tasksCount > 27) {
                    Utils.showNotification('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞–Ω–∏–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 27', 'error');
                    return;
                }
                
                if (time < 5 || time > 240) {
                    Utils.showNotification('–í—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 5 –¥–æ 240 –º–∏–Ω—É—Ç', 'error');
                    return;
                }
                
                const newExam = {
                    id: Date.now(),
                    title: title,
                    description: description,
                    tasksCount: tasksCount,
                    time: time,
                    difficulty: '—Å—Ä–µ–¥–Ω–∏–π',
                    createdAt: Date.now(),
                    updatedAt: Date.now()
                };
                
                AppData.exams.push(newExam);
                Utils.showNotification('–í–∞—Ä–∏–∞–Ω—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                
                StorageManager.saveAppData('exams', AppData.exams);
                
                const syncSuccess = await BotAPI.saveDataToBot('exams', AppData.exams);
                
                if (syncSuccess) {
                    UI.renderExamsList();
                    UI.updateNewExamsBadge();
                    this.renderAdminExamsList();
                }
            }

            static async saveTheory() {
                const title = document.getElementById('admin-theory-title').value.trim();
                const content = document.getElementById('admin-theory-content').value.trim();
                
                if (!title) {
                    Utils.showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞', 'error');
                    return;
                }
                
                if (!content) {
                    Utils.showNotification('–í–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞', 'error');
                    return;
                }
                
                const newTheory = {
                    id: Date.now(),
                    title: title,
                    content: content,
                    createdAt: Date.now()
                };
                
                AppData.theory.push(newTheory);
                
                StorageManager.saveAppData('theory', AppData.theory);
                
                const syncSuccess = await BotAPI.saveDataToBot('theory', AppData.theory);
                
                if (syncSuccess) {
                    Utils.showNotification('–†–∞–∑–¥–µ–ª —Ç–µ–æ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                    UI.renderTheory();
                    this.renderAdminTheoryList();
                    
                    document.getElementById('admin-theory-title').value = '';
                    document.getElementById('admin-theory-content').value = '';
                }
            }

            static renderAdminTasksList() {
                const container = document.getElementById('admin-tasks-list');
                if (!container) return;
                
                if (AppData.tasks.length === 0) {
                    container.innerHTML = '<div style="color: var(--text-muted); text-align: center; padding: 16px;">–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π</div>';
                    return;
                }
                
                let html = '<div style="display: flex; flex-direction: column; gap: 6px;">';
                
                AppData.tasks.slice().reverse().forEach(task => {
                    html += `
                        <div class="admin-task-item" style="display: flex; justify-content: space-between; align-items: center; background: var(--bg-primary); padding: 8px; border-radius: var(--radius-sm); border: 1px solid var(--border-color);">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: var(--accent-primary);">
                                    –ó–∞–¥–∞–Ω–∏–µ #${task.number} ‚Ä¢ ${task.theme}
                                </div>
                                <div style="font-size: 11px; color: var(--text-secondary); margin-top: 3px;">
                                    ${task.text.substring(0, 40)}${task.text.length > 40 ? '...' : ''}
                                </div>
                                <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">
                                    –û—Ç–≤–µ—Ç: ${task.answer} | –¢–∏–ø: ${task.type}
                                </div>
                            </div>
                            <div style="display: flex; gap: 3px;">
                                <button class="action-btn edit-task-btn" data-task-id="${task.id}" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" style="width: 30px; height: 30px;">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-task-btn" data-task-id="${task.id}" title="–£–¥–∞–ª–∏—Ç—å" style="width: 30px; height: 30px;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
                
                container.querySelectorAll('.edit-task-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const taskId = parseInt(this.getAttribute('data-task-id'));
                        AdminUI.enableEditMode(taskId);
                        const editModeSelect = document.getElementById('admin-edit-mode');
                        if (editModeSelect) editModeSelect.value = 'edit';
                        const editGroup = document.getElementById('edit-task-select-group');
                        if (editGroup) editGroup.style.display = 'block';
                        const editSelect = document.getElementById('admin-edit-task-select');
                        if (editSelect) editSelect.value = taskId;
                    });
                });
                
                container.querySelectorAll('.delete-task-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const taskId = parseInt(this.getAttribute('data-task-id'));
                        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ?')) {
                            const taskIndex = AppData.tasks.findIndex(t => t.id === taskId);
                            if (taskIndex !== -1) {
                                AppData.tasks.splice(taskIndex, 1);
                                StorageManager.saveAppData('tasks', AppData.tasks);
                                BotAPI.saveDataToBot('tasks', AppData.tasks);
                                Utils.showNotification('–ó–∞–¥–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'success');
                                AdminUI.renderAdminTasksList();
                                
                                if (AppData.editingTaskId === taskId) {
                                    AdminUI.disableEditMode();
                                }
                            }
                        }
                    });
                });
            }

            static renderAdminExamsList() {
                const container = document.getElementById('admin-exams-list');
                if (!container) return;
                
                if (AppData.exams.length === 0) {
                    container.innerHTML = '<div style="color: var(--text-muted); text-align: center; padding: 16px;">–ù–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</div>';
                    return;
                }
                
                let html = '<div style="display: flex; flex-direction: column; gap: 6px;">';
                
                AppData.exams.slice().reverse().forEach(exam => {
                    html += `
                        <div class="admin-task-item" style="display: flex; justify-content: space-between; align-items: center; background: var(--bg-primary); padding: 8px; border-radius: var(--radius-sm); border: 1px solid var(--border-color);">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: var(--exam-color);">
                                    ${exam.title}
                                </div>
                                <div style="font-size: 11px; color: var(--text-secondary); margin-top: 3px;">
                                    ${exam.description.substring(0, 40)}${exam.description.length > 40 ? '...' : ''}
                                </div>
                                <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">
                                    ${exam.tasksCount} –∑–∞–¥–∞–Ω–∏–π ‚Ä¢ ${exam.time} –º–∏–Ω ‚Ä¢ ${exam.difficulty}
                                </div>
                            </div>
                            <div style="display: flex; gap: 3px;">
                                <button class="action-btn delete-exam-btn" data-exam-id="${exam.id}" title="–£–¥–∞–ª–∏—Ç—å" style="width: 30px; height: 30px;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
                
                container.querySelectorAll('.delete-exam-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const examId = parseInt(this.getAttribute('data-exam-id'));
                        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç?')) {
                            const examIndex = AppData.exams.findIndex(e => e.id === examId);
                            if (examIndex !== -1) {
                                AppData.exams.splice(examIndex, 1);
                                StorageManager.saveAppData('exams', AppData.exams);
                                BotAPI.saveDataToBot('exams', AppData.exams);
                                Utils.showNotification('–í–∞—Ä–∏–∞–Ω—Ç —É–¥–∞–ª–µ–Ω', 'success');
                                AdminUI.renderAdminExamsList();
                            }
                        }
                    });
                });
            }

            static renderAdminTheoryList() {
                const container = document.getElementById('admin-theory-list');
                if (!container) return;
                
                if (AppData.theory.length === 0) {
                    container.innerHTML = '<div style="color: var(--text-muted); text-align: center; padding: 16px;">–ù–µ—Ç —Ä–∞–∑–¥–µ–ª–æ–≤ —Ç–µ–æ—Ä–∏–∏</div>';
                    return;
                }
                
                let html = '<div style="display: flex; flex-direction: column; gap: 6px;">';
                
                AppData.theory.slice(-10).reverse().forEach(section => {
                    html += `
                        <div style="background: var(--bg-secondary); padding: 8px; border-radius: var(--radius-sm); border: 1px solid var(--border-color);">
                            <div style="font-weight: 600; color: var(--accent-primary); margin-bottom: 3px;">
                                ${section.title}
                            </div>
                            <div style="font-size: 11px; color: var(--text-secondary);">
                                ${section.content.substring(0, 70)}${section.content.length > 70 ? '...' : ''}
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
            }

            static async loadUsersStats() {
                try {
                    const usersData = await BotAPI.loadDataFromBot('users') || [];
                    this.updateUsersStats(usersData);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
                }
            }

            static updateUsersStats(usersData) {
                const totalUsers = document.getElementById('total-users');
                const activeToday = document.getElementById('active-today');
                
                if (totalUsers) totalUsers.textContent = usersData.length;
                
                const today = new Date().toISOString().split('T')[0];
                const activeTodayCount = usersData.filter(user => {
                    return user.lastActive && user.lastActive.startsWith(today);
                }).length;
                
                if (activeToday) activeToday.textContent = activeTodayCount;
            }

            static showAuthModal() {
                const authModal = document.getElementById('auth-modal');
                const adminPassword = document.getElementById('admin-password');
                const authError = document.getElementById('auth-error');
                
                if (authModal) authModal.classList.add('active');
                if (adminPassword) {
                    adminPassword.focus();
                    adminPassword.value = '';
                }
                if (authError) authError.textContent = '';
            }

            static hideAuthModal() {
                const authModal = document.getElementById('auth-modal');
                const adminPassword = document.getElementById('admin-password');
                
                if (authModal) authModal.classList.remove('active');
                if (adminPassword) adminPassword.value = '';
            }

            static checkPassword() {
                const password = document.getElementById('admin-password').value;
                const authError = document.getElementById('auth-error');
                
                if (password === CONFIG.ADMIN_PASSWORD) {
                    AppData.isAdminAuthenticated = true;
                    this.hideAuthModal();
                    this.showAdminPanel();
                    Utils.showNotification('–î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω', 'success');
                } else {
                    if (authError) authError.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
                    const adminPassword = document.getElementById('admin-password');
                    if (adminPassword) {
                        adminPassword.value = '';
                        adminPassword.focus();
                    }
                }
            }
        }

        class App {
            static async init() {
                this.initTelegram();
                this.loadBotSettings();
                StorageManager.loadUserData();
                
                const loadingOverlay = document.getElementById('loading-overlay');
                
                try {
                    await this.loadAppData();
                    
                    UI.updateStatsDisplay();
                    UI.updateDailyProgress();
                    UI.updateStreak();
                    UI.renderAchievements();
                    UI.renderTasksList();
                    UI.renderExamsList();
                    UI.renderTheory();
                    
                    UI.updateNewTasksBadge();
                    UI.updateNewExamsBadge();
                    
                    UI.showRandomTask();
                    
                    this.setupEventListeners();
                    
                    SyncManager.startAutoSync();
                    SyncManager.syncUserData();
                    
                    setTimeout(() => {
                        if (loadingOverlay) {
                            loadingOverlay.classList.add('hidden');
                            setTimeout(() => {
                                loadingOverlay.style.display = 'none';
                            }, 300);
                        }
                    }, 500);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                    if (loadingOverlay) {
                        loadingOverlay.innerHTML = `
                            <div style="text-align: center; color: var(--error-color);">
                                <i class="fas fa-exclamation-triangle" style="font-size: 40px; margin-bottom: 12px;"></i>
                                <div style="font-weight: 600; margin-bottom: 6px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                                <div style="font-size: 13px; margin-bottom: 16px;">${error.message}</div>
                                <button class="btn btn-primary" id="retry-load-btn">
                                    <i class="fas fa-redo"></i>
                                    <span>–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</span>
                                </button>
                            </div>
                        `;
                        
                        document.getElementById('retry-load-btn')?.addEventListener('click', () => {
                            location.reload();
                        });
                    }
                }
            }

            static initTelegram() {
                try {
                    tg = window.Telegram?.WebApp;
                    
                    if (tg) {
                        tg.ready();
                        tg.expand();
                        
                        if (tg.colorScheme === 'dark') {
                            document.body.classList.add('theme-dark');
                        }
                        
                        tg.onEvent('themeChanged', () => {
                            if (tg.colorScheme === 'dark') {
                                document.body.classList.add('theme-dark');
                            } else {
                                document.body.classList.remove('theme-dark');
                            }
                        });
                        
                        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                            userId = tg.initDataUnsafe.user.id.toString();
                        } else {
                            userId = 'web_' + Math.random().toString(36).substr(2, 9);
                        }
                    } else {
                        userId = 'web_' + Math.random().toString(36).substr(2, 9);
                        
                        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                            document.body.classList.add('theme-dark');
                        }
                    }
                } catch (e) {
                    userId = 'web_' + Math.random().toString(36).substr(2, 9);
                }
            }

            static loadBotSettings() {
                const savedToken = localStorage.getItem(CONFIG.STORAGE_PREFIX + 'bot_token');
                const savedChatId = localStorage.getItem(CONFIG.STORAGE_PREFIX + 'admin_chat_id');
                
                if (savedToken && savedToken !== CONFIG.DEFAULT_BOT_TOKEN) {
                    botToken = savedToken;
                }
                
                if (savedChatId && savedChatId !== CONFIG.DEFAULT_ADMIN_CHAT_ID) {
                    adminChatId = savedChatId;
                }
                
                BOT_API_URL = `https://api.telegram.org/bot${botToken}`;
            }

// 3. –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø loadAppData:
static async loadAppData() {
    try {
        const [botTasks, botExams, botTheory] = await Promise.all([
            BotAPI.loadDataFromBot('tasks'),
            BotAPI.loadDataFromBot('exams'),
            BotAPI.loadDataFromBot('theory')
        ]);
        
        if (botTasks && botTasks.length > 0) {
            AppData.tasks = botTasks;
            StorageManager.saveAppData('tasks', AppData.tasks);
        } else {
            const savedTasks = StorageManager.loadAppData('tasks');
            if (savedTasks && savedTasks.length > 0) {
                AppData.tasks = savedTasks;
            } else {
                AppData.tasks = this.getInitialTasks();
                StorageManager.saveAppData('tasks', AppData.tasks);
                await BotAPI.saveDataToBot('tasks', AppData.tasks);
            }
        }
        
        if (botExams && botExams.length > 0) {
            AppData.exams = botExams;
            StorageManager.saveAppData('exams', AppData.exams);
        } else {
            const savedExams = StorageManager.loadAppData('exams');
            if (savedExams) {
                AppData.exams = savedExams;
            } else {
                AppData.exams = this.getInitialExams();
                StorageManager.saveAppData('exams', AppData.exams);
                await BotAPI.saveDataToBot('exams', AppData.exams);
            }
        }
        
        if (botTheory && botTheory.length > 0) {
            AppData.theory = botTheory;
            StorageManager.saveAppData('theory', AppData.theory);
        } else {
            const savedTheory = StorageManager.loadAppData('theory');
            if (savedTheory) {
                AppData.theory = savedTheory;
            } else {
                AppData.theory = this.getInitialTheory();
                StorageManager.saveAppData('theory', AppData.theory);
                await BotAPI.saveDataToBot('theory', AppData.theory);
            }
        }
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
    }
}

            static getInitialTasks() {
                return [
                    {
                        id: 1,
                        number: 1,
                        theme: "–û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—è",
                        text: "–í –∫–∞–∫–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ –æ—Ç–≤–µ—Ç–∞ <span class='highlight'>–≤—ã–¥–µ–ª–µ–Ω–Ω–æ–µ —Å–ª–æ–≤–æ</span> —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–æ –Ω–µ–≤–µ—Ä–Ω–æ?",
                        options: ["–∫—Ä–ê–Ω—ã", "–¥–û–Ω–∏–∑—É", "–æ—Ç–æ–∑–≤–ê–ª–∞", "–ø–æ–∑–≤–æ–Ω–ò—Ç"],
                        answer: "–∫—Ä–ê–Ω—ã",
                        hint: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–¥–∞—Ä–µ–Ω–∏–µ: –∫—Ä–∞—Å–Ω–´ (–µ–¥.—á. - –∫—Ä–∞–Ω), –¥–æ–Ω–ò–∑—É, –æ—Ç–æ–∑–≤–∞–ª–ê, –ø–æ–∑–≤–æ–Ω–ò—Ç",
                        type: "single",
                        createdAt: Date.now(),
                        updatedAt: Date.now()
                    },
                    {
                        id: 2,
                        number: 2,
                        theme: "–ü–∞—Ä–æ–Ω–∏–º—ã",
                        text: "–í –∫–∞–∫–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ –æ—Ç–≤–µ—Ç–∞ <span class='highlight'>–≤—ã–¥–µ–ª–µ–Ω–Ω–æ–µ —Å–ª–æ–≤–æ</span> —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–æ –Ω–µ–≤–µ—Ä–Ω–æ?",
                        options: [
                            "–≠—Ç–æ –±—ã–ª –ö–û–ú–ê–ù–î–ò–†–û–í–û–ß–ù–´–ô –∞–≤—Ç–æ–º–æ–±–∏–ª—å, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è —Å–ª—É–∂–µ–±–Ω—ã—Ö –ø–æ–µ–∑–¥–æ–∫.",
                            "–ù–∞ —Å–æ–±—Ä–∞–Ω–∏–∏ –æ–±—Å—É–∂–¥–∞–ª–∏—Å—å –í–û–ü–†–û–°–´ –ñ–ò–õ–ò–©–ù–û–ì–û —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞.",
                            "–ù–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–∏ –¥–µ–π—Å—Ç–≤—É–µ—Ç –≠–ö–û–ù–û–ú–ò–ß–ï–°–ö–ò–ô –æ—Ç–¥–µ–ª, –∑–∞–Ω–∏–º–∞—é—â–∏–π—Å—è –≤–æ–ø—Ä–æ—Å–∞–º–∏ —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏—è.",
                            "–û–Ω –±—ã–ª –∏–∑–≤–µ—Å—Ç–Ω—ã–º –î–ò–ü–õ–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ú —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–º, —É–º–µ–≤—à–∏–º –Ω–∞—Ö–æ–¥–∏—Ç—å –ø–æ–¥—Ö–æ–¥ –∫ –ª—é–±–æ–º—É —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É."
                        ],
                        answer: "–ö–û–ú–ê–ù–î–ò–†–û–í–û–ß–ù–´–ô",
                        hint: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–æ—á–Ω–æ–µ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ, –Ω–æ –∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–æ—á–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å - –Ω–µ–≤–µ—Ä–Ω–æ. –ù—É–∂–Ω–æ: —Å–ª—É–∂–µ–±–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å.",
                        type: "single",
                        createdAt: Date.now(),
                        updatedAt: Date.now()
                    }
                ];
            }

            static getInitialExams() {
                return [
                    {
                        id: 1,
                        title: "–ü—Ä–æ–±–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç #1",
                        description: "–ë–∞–∑–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ —Å —Ñ–æ—Ä–º–∞—Ç–æ–º –ï–ì–≠",
                        tasksCount: 10,
                        time: 60,
                        difficulty: "—Å—Ä–µ–¥–Ω–∏–π",
                        createdAt: Date.now(),
                        updatedAt: Date.now()
                    },
                    {
                        id: 2,
                        title: "–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç",
                        description: "–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏",
                        tasksCount: 15,
                        time: 90,
                        difficulty: "–ª–µ–≥–∫–∏–π",
                        createdAt: Date.now(),
                        updatedAt: Date.now()
                    }
                ];
            }

            static getInitialTheory() {
                return [
                    {
                        id: 1,
                        title: "–û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—è: –ø—Ä–∞–≤–æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏—Å—Ç–∞–≤–æ–∫",
                        content: `
                            <h3>–ü—Ä–∞–≤–æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏—Å—Ç–∞–≤–æ–∫ –ü–†–ï- –∏ –ü–†–ò-</h3>
                            <p>–ü—Ä–∏—Å—Ç–∞–≤–∫–∞ –ü–†–ò- –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç:</p>
                            <ul>
                                <li>–ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ (–ø—Ä–∏–µ—Ö–∞—Ç—å, –ø—Ä–∏–π—Ç–∏)</li>
                                <li>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–ø—Ä–∏—à–∏—Ç—å, –ø—Ä–∏–∫–ª–µ–∏—Ç—å)</li>
                                <li>–ù–µ–ø–æ–ª–Ω–æ—Ç—É –¥–µ–π—Å—Ç–≤–∏—è (–ø—Ä–∏–æ—Ç–∫—Ä—ã—Ç—å, –ø—Ä–∏—Å–µ—Å—Ç—å)</li>
                                <li>–ë–ª–∏–∑–æ—Å—Ç—å (–ø—Ä–∏–º–æ—Ä—Å–∫–∏–π, –ø—Ä–∏—à–∫–æ–ª—å–Ω—ã–π)</li>
                            </ul>
                            <p>–ü—Ä–∏—Å—Ç–∞–≤–∫–∞ –ü–†–ï- –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç:</p>
                            <ul>
                                <li>–í—ã—Å–æ–∫—É—é —Å—Ç–µ–ø–µ–Ω—å –∫–∞—á–µ—Å—Ç–≤–∞ (–ø—Ä–µ–º—É–¥—Ä—ã–π, –ø—Ä–µ–∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π)</li>
                                <li>–ó–Ω–∞—á–µ–Ω–∏–µ "–ø–µ—Ä–µ-" (–ø—Ä–µ–≥—Ä–∞–¥–∏—Ç—å, –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å)</li>
                            </ul>
                        `,
                        createdAt: Date.now()
                }
                ];
            }

            static setupEventListeners() {
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const tabName = this.getAttribute('data-tab');
                        if (tabName) {
                            UI.switchTab(tabName);
                        }
                    });
                    
                    btn.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        e.currentTarget.click();
                    }, { passive: false });
                });
                
                const setupButton = (id, handler) => {
                    const btn = document.getElementById(id);
                    if (btn) {
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            handler();
                        });
                        
                        btn.addEventListener('touchstart', (e) => {
                            e.preventDefault();
                            e.currentTarget.click();
                        }, { passive: false });
                    }
                };
                
                setupButton('check-btn', () => GameLogic.checkAnswer());
                setupButton('next-btn', () => UI.showRandomTask());
                setupButton('hint-btn', () => GameLogic.showHint());
                setupButton('favorite-btn', () => GameLogic.toggleFavorite());
                setupButton('start-exam-btn', () => {
                    if (AppData.exams.length > 0) {
                        const randomIndex = Math.floor(Math.random() * AppData.exams.length);
                        GameLogic.startExam(AppData.exams[randomIndex].id);
                    } else {
                        Utils.showNotification('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–æ–±–Ω–∏–∫–æ–≤', 'error');
                    }
                });
                
                document.querySelectorAll('.icon-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const id = this.id;
                        
                        if (id === 'stats-btn') {
                            UI.switchTab('tasks');
                        } else if (id === 'achievements-btn') {
                            UI.switchTab('achievements');
                        } else if (id === 'sync-btn') {
                            SyncManager.forceSync();
                        } else if (id === 'admin-btn') {
                            AdminUI.showAdminPanel();
                        }
                    });
                    
                    btn.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        e.currentTarget.click();
                    }, { passive: false });
                });
                
                const setupAdminButton = (id, handler) => {
                    const btn = document.getElementById(id);
                    if (btn) {
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            handler();
                        });
                        
                        btn.addEventListener('touchstart', (e) => {
                            e.preventDefault();
                            e.currentTarget.click();
                        }, { passive: false });
                    }
                };
                
                setupAdminButton('close-admin', () => AdminUI.closeAdminPanel());
                setupAdminButton('save-task-btn', () => AdminUI.saveTask());
                setupAdminButton('delete-task-btn', () => AdminUI.deleteTask());
                setupAdminButton('save-exam-btn', () => AdminUI.saveExam());
                setupAdminButton('save-theory-btn', () => AdminUI.saveTheory());
                setupAdminButton('reset-user-btn', () => StorageManager.resetUserData());
                setupAdminButton('force-sync-btn', () => SyncManager.forceSync());
                
                document.querySelectorAll('.admin-tab').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const tabName = this.getAttribute('data-admin-tab');
                        UI.switchAdminTab(tabName);
                    });
                    
                    btn.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        e.currentTarget.click();
                    }, { passive: false });
                });
                
                const editModeSelect = document.getElementById('admin-edit-mode');
                if (editModeSelect) {
                    editModeSelect.addEventListener('change', function() {
                        const editGroup = document.getElementById('edit-task-select-group');
                        if (editGroup) editGroup.style.display = this.value === 'edit' ? 'block' : 'none';
                        if (this.value === 'edit') AdminUI.populateEditTaskSelect();
                    });
                }
                
                const editTaskSelect = document.getElementById('admin-edit-task-select');
                if (editTaskSelect) {
                    editTaskSelect.addEventListener('change', function() {
                        const taskId = parseInt(this.value);
                        if (taskId) AdminUI.enableEditMode(taskId);
                    });
                }
                
                setupAdminButton('submit-password', () => AdminUI.checkPassword());
                setupAdminButton('cancel-auth', () => AdminUI.hideAuthModal());
                
                document.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const answerInput = document.getElementById('answer-input');
                        if (answerInput && answerInput.style.display !== 'none' && document.activeElement === answerInput) {
                            GameLogic.checkAnswer();
                        }
                        
                        const adminPassword = document.getElementById('admin-password');
                        if (adminPassword && document.activeElement === adminPassword) {
                            AdminUI.checkPassword();
                        }
                    }
                });
                
                const answerInput = document.getElementById('answer-input');
                if (answerInput) {
                    answerInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            GameLogic.checkAnswer();
                        }
                    });
                }
                
                document.querySelectorAll('button').forEach(btn => {
                    btn.addEventListener('touchstart', function(e) {
                        if (this.getAttribute('type') !== 'submit') {
                            e.preventDefault();
                        }
                    }, { passive: false });
                });
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                App.init();
            }, 100);
            
            document.addEventListener('touchmove', function(e) {
                if (e.scale !== 1) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            document.addEventListener('contextmenu', function(e) {
                if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                }
            });
        });

// 5. –î–û–ë–ê–í–¨–¢–ï –≠–¢–û –í –ö–û–ù–ï–¶ –ö–û–î–ê (–æ—Ç–ª–∞–¥–∫–∞):
// –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
window.checkBot = async () => {
    console.log('=== –ü–†–û–í–ï–†–ö–ê –ë–û–¢–ê ===');
    console.log('–¢–æ–∫–µ–Ω:', botToken);
    console.log('Chat ID:', adminChatId);
    
    try {
        const response = await fetch(`https://api.telegram.org/bot${botToken}/getMe`);
        const data = await response.json();
        console.log('–ë–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω:', data.ok);
        if (data.ok) console.log('–ò–º—è –±–æ—Ç–∞:', data.result.first_name);
    } catch(e) {
        console.error('–û—à–∏–±–∫–∞:', e);
    }
};

window.testSave = async () => {
    console.log('=== –¢–ï–°–¢ –°–û–•–†–ê–ù–ï–ù–ò–Ø ===');
    const testData = [{id: 999, text: "–¢–µ—Å—Ç"}];
    const success = await BotAPI.saveDataToBot('test', testData);
    console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', success ? '‚úÖ –£—Å–ø–µ—à–Ω–æ' : '‚ùå –û—à–∏–±–∫–∞');
};

// –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞
setTimeout(() => {
    console.log('–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–æ—Ç–∞: checkBot()');
    console.log('–î–ª—è —Ç–µ—Å—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: testSave()');
}, 3000);
    </script>
</body>
</html>
